<?php
/**
 * PayLater extension for Magento
 *
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Open Software License (OSL 3.0)
 * that is bundled with this package in the file LICENSE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/osl-3.0.php
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade
 * the PayLater PayLater module to newer versions in the future.
 * If you wish to customize the PayLater PayLater module for your needs
 * please refer to http://www.magentocommerce.com for more information.
 *
 * @category   PayLater
 * @package    PayLater_PayLater
 * @copyright  Copyright (C) 2013 PayLater
 * @license    http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
 */
?>
<script type="text/javascript" src="<?php echo $this->getKnockoutJsSrc() ?>"></script>
<script type="text/javascript" src="<?php echo $this->getDukeJsSrc() ?>"></script>
<script type="text/javascript">
	PAYLATER_WIDGETS_DEBUG = <?php echo Mage::helper('paylater')->getPayLaterConfigDebug('widgets') ? 'true' : 'false' ?> ;
	bindEvent(window, 'load', function() {
		try {
			loadScript("<?php echo $this->getWidgetsJsSrc() ?>", function() {
				//$('row_paylater_widgets_debug').setAttribute('data-bind', 'visible: shouldShowDebugRow');
				$('paylater_widgets_types').setAttribute('data-bind', 'options: typeOptions, disable: checkInherits,value: widgetSelection, optionsCaption: "<?php echo Mage::helper('paylater')->__('Select a Widget Type') ?>"');
				$('paylater_widgets_cart_config').setAttribute('data-bind', 'value: ko.toJSON(currentCartWidget, null, 2)');
				$('paylater_widgets_product_config').setAttribute('data-bind', 'value: ko.toJSON(currentProductWidget, null, 2)');
				$('paylater_widgets_checkout_config').setAttribute('data-bind', 'value: ko.toJSON(currentCheckoutWidget, null, 2)');
				$('paylater_widgets_selection').setAttribute('data-bind', 'disable: checkInherits, options: widgetOptions, value: selectedWidget, optionsCaption: "<?php echo Mage::helper('paylater')->__('Select a Widget') ?>"');
				$('row_paylater_widgets_selection').setAttribute('data-bind', 'visible: widgetSelection');
                $('paylater_widgets_types_inherit') ? $('paylater_widgets_types_inherit').setAttribute('data-bind', 'checked: checkInherits, visible: checkInherits') : '';
                $('paylater_widgets_product_config_inherit') ? $('paylater_widgets_product_config_inherit').setAttribute('data-bind', 'checked: checkInherits, visible: checkInherits') : '';
                $('paylater_widgets_selection_inherit') ? $('paylater_widgets_selection_inherit').setAttribute('data-bind', 'checked: checkInherits, visible: checkInherits') : '';
                $('paylater_widgets_cart_config_inherit') ? $('paylater_widgets_cart_config_inherit').setAttribute('data-bind', 'checked: checkInherits, visible: checkInherits') : '';
                $('paylater_widgets_checkout_config_inherit') ? $('paylater_widgets_checkout_config_inherit').setAttribute('data-bind', 'checked: checkInherits, visible: checkInherits') : '';
				ko.applyBindings(new PayLaterWidgetsModel('<?php echo json_encode(json_decode(file_get_contents($this->getWidgetsJSON()))) ?>', <?php echo $this->getStoreConfiguredWidget('product') ?>, <?php echo json_encode(json_decode($this->getStoreConfiguredWidget('cart'))) ?>, <?php echo $this->getStoreConfiguredWidget('checkout') ?>));
			});
		} catch (e) {
			if (PAYLATER_WIDGETS_DEBUG) {
				console.log(e)
			}
		}
	});
</script>
