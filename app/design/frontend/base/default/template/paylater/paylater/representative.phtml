<?php
/**
 * PayLater extension for Magento
 *
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Open Software License (OSL 3.0)
 * that is bundled with this package in the file LICENSE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/osl-3.0.php
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade
 * the PayLater PayLater module to newer versions in the future.
 * If you wish to customize the PayLater PayLater module for your needs
 * please refer to http://www.magentocommerce.com for more information.
 *
 * @category   PayLater
 * @package    PayLater_PayLater
 * @copyright  Copyright (C) 2013 PayLater
 * @license    http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
 */
?>
<?php if (Mage::helper('paylater')->isAllowedCurrency()): ?>
	<?php
		$offerLower = Mage::getStoreConfig('paylater/paylater/min_order_total');
		$offerUpper = Mage::getStoreConfig('paylater/paylater/paylater/max_order_total');
		$outOfRange = sprintf(Mage::getStoreConfig('paylater/product/out_range_message'), $offerLower, $offerUpper);
		$price = $this->getAmount();
	?>
	<?php $this->getConfiguredWidget() ?>
	<?php if($this->hasWidgetBeenConfigured()): ?>
	<?php $this->getConfiguredWidget();?>

	<script type="text/javascript">
	    var offerLowerBound = <?php echo $offerLower ?>;
	    var offerUpperBound = <?php echo $offerUpper ?>;
	    var plOutOfRange = "<?php echo $outOfRange ?>";
	    var plDataShowBreakDown = <?php echo $this->doesWidgetHaveBreakdown() ? $this->getWidgetShowBreakdown() : 'false'; ?>;
	    var plDataName = "<?php echo $this->getWidgetName() ?>";
	    var plDataParams = '<?php echo $this->doesWidgetHaveParameters() ? $this->getWidgetParamsAsString() : 'false'; ?>';
	    var plDataLegal = "<?php echo Mage::helper('paylater')->getRepresentativeLegal() ?>";
	</script>
	<?php endif; ?>
	<?php if ($this->canShow()): ?>
	    <?php if($this->hasWidgetBeenConfigured() && !$this->isConfiguredWidgetSameAsDefault()): ?>
	        <div id="paylater-widget-wrapper" class="paylater-widget-wrapper">
	            <div class="pl-widget" data-pl-price="<?php echo $price ?>" data-pl-widget="<?php echo $this->getWidgetName() ?>"
	                <?php echo $this->doesWidgetHaveBreakdown() ? sprintf('%sdata-pl-showbreakdown="%s"', ' ',$this->getWidgetShowBreakdown()) : ' '; ?>
	                <?php echo $this->doesWidgetHaveParameters() ? sprintf('%sdata-pl-params="%s"', ' ', $this->getWidgetParamsAsString()) : ' '; ?> data-pl-legal="<?php echo Mage::helper('paylater')->getRepresentativeLegal() ?>">
	            </div>
	        </div>
	    <?php else: ?>
	        <div id="paylater-widget-wrapper" class="paylater-widget-wrapper">
	            <div class="pl-widget" data-pl-price="<?php echo $price ?>" data-pl-widget="price-offer" data-pl-legal="<?php echo Mage::helper('paylater')->getRepresentativeLegal() ?>"></div>
	        </div>
	    <?php endif; ?>
	<?php else: ?>
		<div id="paylater-widget-wrapper">
			<?php if ($price > $offerUpper || $price < $offerLower): ?>
				<div class="paylater-out-of-range">
					<img src="http://paylater.s3.amazonaws.com/images/paylater-payment-type.png" height="21" width="50"/> <?php echo $outOfRange ?>
				</div>
			<?php endif; ?>
		</div>
	<?php endif; ?>
<?php endif; ?>